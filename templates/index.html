<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HTML5 Deck of Cards</title>
    <link href="{{ url_for('static', filename='example.css') }}" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600|Ubuntu+Condensed" rel="stylesheet" type="text/css">
  </head>
  <body>
    <canvas id="audio-visualizer"
        style="position: fixed;
               top: 0;
               left: 0;
               width: 100vw;
               height: 100vh;
               z-index: 10001;
               pointer-events: none;
               background: transparent;
               display: none;">
</canvas>


<script>
      function iniciarVisualizadorAudio(audioElementId) {
  const audio = document.getElementById(audioElementId);
  const canvas = document.getElementById("audio-visualizer");
  const ctx = canvas.getContext("2d");

  canvas.style.display = "block";

  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const analyser = audioCtx.createAnalyser();
  const source = audioCtx.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(audioCtx.destination);

  analyser.fftSize = 256;
  const bufferLength = analyser.frequencyBinCount;
  const dataArray = new Uint8Array(bufferLength);

  function draw() {
    requestAnimationFrame(draw);
    analyser.getByteFrequencyData(dataArray);
    // si est√° todo en silencio, generamos movimiento leve (respiraci√≥n)
for (let i = 0; i < dataArray.length; i++) {
  dataArray[i] = Math.max(dataArray[i], 10 + Math.sin(Date.now() * 0.002 + i) * 8);
}

    const w = canvas.width;
    const h = canvas.height;
    ctx.clearRect(0, 0, w, h);

    const centerX = w / 2;
    const centerY = 160;  // üîº Top quarter
    const radius = 40;         // üîΩ Smaller

    const points = bufferLength;

    ctx.beginPath();
    for (let i = 0; i < points; i++) {
      const angle = (i / points) * Math.PI * 2;
      const amp = dataArray[i] * 0.5;
      const x = centerX + Math.cos(angle) * (radius + amp);
      const y = centerY + Math.sin(angle) * (radius + amp);
      ctx.lineTo(x, y);
    }
    ctx.closePath();

    const gradient = ctx.createRadialGradient(centerX, centerY, radius * 0.5, centerX, centerY, radius * 2);
    gradient.addColorStop(0, "rgba(173, 216, 230, 0.8)");
    gradient.addColorStop(1, "rgba(138, 43, 226, 0.2)");
    ctx.fillStyle = gradient;
    ctx.fill();

    ctx.strokeStyle = "rgba(255, 255, 255, 0.5)";
    ctx.lineWidth = 2;
    ctx.stroke();
  }
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  draw();
}

      </script>
      
      
    <audio id="musica-fondo" loop autoplay>
      <source src="{{ url_for('static', filename='musica-fondo.mp3') }}" type="audio/mpeg">
      Tu navegador no soporta audio HTML.
    </audio>
    <audio id="audio-intro">
      <source id="audio-source" src="" type="audio/mpeg">
      Tu navegador no soporta audio HTML.
    </audio>
    <audio id="audio-virtual-es" src="{{ url_for('static', filename='modo_virtual_esp.mp3') }}"></audio>
    <audio id="audio-virtual-en" src="{{ url_for('static', filename='modo_virtual_en.mp3') }}"></audio>
    <audio id="audio-fan-es" src="{{ url_for('static', filename='modo_clasico_esp1.mp3') }}"></audio>
    <audio id="audio-fan-en" src="{{ url_for('static', filename='modo_clasico_en.mp3') }}"></audio>
    
    <script>
function cerrarModal() {
  const modal = document.getElementById("modal-instrucciones");
  modal.style.display = "none";

  const audioIntro = document.getElementById("audio-intro");
  const audioSource = document.getElementById("audio-source");

  let archivo;

  if (idiomaSeleccionado === "en") {
    archivo = "intro1_en.mp3";
    audioSource.src = "static/intro1_en.mp3";
  } else {
    archivo = "intro1_esp.mp3";
    audioSource.src = "static/intro1_esp.mp3";
  }

  audioIntro.load();
  audioIntro.play()
    .then(() => {
      mostrarSubtituloDesdeAudio(archivo);
      iniciarVisualizadorAudio("audio-intro"); // üîÆ AQUI activ√°s la esfera
    })
    .catch(e => console.warn("üéôÔ∏è No se pudo reproducir el audio:", e));

  audioIntro.addEventListener('ended', () => {
    mostrarSeleccionSesion();
    document.getElementById("audio-visualizer").style.display = "none"; // ‚ùå ocultar la esfera al terminar
  }, { once: true });
}
    

    
      mostrarSeleccionSesion();
    
    
    function cambiarIdioma(idioma) {
  idiomaSeleccionado = idioma;
  const nombre = document.getElementById("nombre-usuario").value.trim();
  window.nombreUsuario = nombre || "Consultante";

  const texto = document.getElementById("modal-texto");

  if (idioma === "en") {
    texto.innerHTML = `
      Discover the mysteries of tarot. As you enter, a mystical deck awaits you.<br><br>
    `;
    document.body.style.backgroundImage = "url('static/deck/mesa3.0en.png')";
  } else {
    texto.innerHTML = `
      Explora los misterios del tarot. Al ingresar, ver√°s un mazo m√≠stico esper√°ndote.<br><br>
    `;
    document.body.style.backgroundImage = "url('static/deck/mesa3.0esp.png')";
  }

  if (typeof window.ElevenLabsConvai !== "undefined") {
    window.ElevenLabsConvai.render();
  }

  document.getElementById("boton-comenzar").style.display = "inline-block";
  document.getElementById("boton-shuffle").style.display = "none"; // üëà ocultar mientras est√°n los modales
  

}
        
      </script>

<script>
  const music = document.getElementById("musica-fondo");

  // Establece el volumen desde el inicio
  music.volume = 0.01;

  // Algunos navegadores requieren interacci√≥n del usuario para reproducir audio
  window.addEventListener('click', () => {
    music.volume = 0.09; // volumen s√∫per bajo
    music.play().catch((e) => console.warn("üéµ Error al reproducir m√∫sica:", e));
  }, { once: true });
  
</script>
<div id="contenedor-shuffle">
  <button id="boton-shuffle" onclick="mezclarMazo()">üîÄ Revolver Mazo</button>
</div>
<style>
  #boton-shuffle {
    position: fixed;
    left: 50%;
    bottom: 2vh; /* ‚úÖ Siempre visible y con margen adaptable */
    transform: translateX(-50%);
    background-color: #8b5c2d;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 8px;
    font-size: 16px;
    cursor: pointer;
    z-index: 10000;
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  
  
  
    #boton-shuffle:hover {
      background-color: #a56a3a;
    }
  </style>

    <div id="container">    </div>
    
  <!-- Modal instrucciones -->
  <div id="modal-instrucciones" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: url('mesa.png'); background-size: cover; background-position: center; z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;">
    <div style="
    max-width: 650px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    background: rgba(245, 222, 179, 0.93);
    border: 2px solid #8b5c2d;
    border-radius: 12px;
    padding: 40px 30px;
    text-align: center;
    box-shadow: 0 0 25px rgba(0,0,0,0.6);
    font-family: 'Open Sans', serif;
    color: #2f1e0c;
    backdrop-filter: blur(2px);
  ">
        <h2 style="font-family: 'Ubuntu Condensed', sans-serif; font-size: 28px; margin-bottom: 20px;">
        üîÆ Tarot
      </h2>
      <div style="margin-bottom: 20px;">
        <span style="font-size: 14px; font-weight: bold; color: #4b2e17;">üåç Idioma:</span>
        

        <button onclick="cambiarIdioma('es')" style="margin-left: 10px; background: none; border: none; cursor: pointer;" title="Espa√±ol">
          <img src="https://flagcdn.com/w40/es.png" alt="ES" style="height: 20px; border-radius: 3px;">
        </button>
        <button onclick="cambiarIdioma('en')" style="margin-left: 5px; background: none; border: none; cursor: pointer;" title="English">
          <img src="https://flagcdn.com/w40/us.png" alt="US" style="height: 20px; border-radius: 3px;">
        </button>
        <p id="mensaje-idioma" style="margin-top: 10px; font-size: 14px; color: #b33939; display: block;">
          üëâ Selecciona un idioma para comenzar./Select a language to get started.
        </p>
        
        <input type="text" id="nombre-usuario" placeholder="Tu nombre.../ Your name..." 
        style="margin-top: 10px; padding: 8px; width: 80%; font-size: 16px; border-radius: 6px; border: 1px solid #ccc;">
      </div>
      <p id="modal-texto" style="margin-top: 10px; font-size: 18px; line-height: 1.5;">
        Explora los misterios del tarot. Al ingresar, ver√°s un mazo m√≠stico esper√°ndote.<br><br>
      </p>
      <button id="boton-comenzar" onclick="cerrarModal()" style="display: none; margin-top: 25px; background: #8b5c2d; color: #fff; border: none; padding: 10px 24px; border-radius: 8px; font-size: 16px; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: background 0.3s ease;" onmouseover="this.style.background='#a56a3a'" onmouseout="this.style.background='#8b5c2d'">
        ‚ú® Comenzar
      </button>
      <div id="mensaje-mistico" style="margin-top: 15px; font-style: italic; color: #6a0dad; animation: parpadeo 1s infinite;">
        üßô‚Äç‚ôÄÔ∏è ‚Äú...‚Äù
      </div>
      
      <style>
      @keyframes parpadeo {
        0% { opacity: 1; }
        50% { opacity: 0.3; }
        100% { opacity: 1; }
      }
      </style>

    </div>
  </div>
  <div id="modal-sesion" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9998; display: flex; align-items: center; justify-content: center;">
    <div style="background: #f4e7d4; padding: 40px; border-radius: 16px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.6); max-width: 500px; width: 90%;">
      <h2 style="margin-bottom: 20px;">‚ú® Elige el tipo de sesi√≥n</h2>
      <button onclick="saltarIntro()" style="margin-top: 15px; background: #444; color: white; padding: 8px 18px; border-radius: 8px; font-size: 14px; cursor: pointer;">
        ‚è≠Ô∏è Saltar Intro / Skip Intro
      </button>
      <button onclick="elegirSesion('virtual')" style="margin: 10px; padding: 12px 24px; font-size: 18px; border: none; border-radius: 8px; background: #7a5195; color: white; cursor: pointer;">üîÆ Virtual</button>
      <button onclick="elegirSesion('presencial')" style="margin: 10px; padding: 12px 24px; font-size: 18px; border: none; border-radius: 8px; background: #ef476f; color: white; cursor: pointer;">üè† Presencial</button>
    </div>
  </div>
  
  <!-- Modos seg√∫n la sesi√≥n -->
  <div id="modal-modo" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 9997; display: flex; align-items: center; justify-content: center;">
    <div id="opciones-modo" style="background: #eae2b7; padding: 40px; border-radius: 16px; text-align: center; box-shadow: 0 0 20px rgba(0,0,0,0.6); max-width: 500px; width: 90%;">
      <h2 style="margin-bottom: 20px;">üîÆ Elige tu modo</h2>
      <div id="botones-modos"></div>
    </div>
  </div>
  
    <div id="topbar"></div><a href="https://github.com/pakastin/deck-of-cards"><img class="gh-ribbon" style="position: fixed; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/52760788cde945287fbb584134c4cbc2bc36f904/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f77686974655f6666666666662e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png"></a>
    <script src="{{ url_for('static', filename='deck_tarot_cleaned.js') }}"></script>
<script src="{{ url_for('static', filename='example.js') }}"></script>
<!-- üîà Bot√≥n parlante + subt√≠tulo -->
<!-- üîà Bot√≥n parlante -->
<div id="audio-control" style="position: fixed; top: 20px; left: 20px; z-index: 10001;">
  <button onclick="toggleMute()" id="mute-button" style="
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: white;
    text-shadow: 0 0 4px black;">üîä</button>
</div>

<!-- ‚úÖ Subt√≠tulo centrado abajo -->
<div id="subtitulo-audio" style="
  position: fixed;
  bottom: 2vh;
  left: 50%;
  transform: translateX(-50%);
  width: 90vw;
  max-height: 8em; /* Aprox. 6 l√≠neas */
  background-color: rgba(0, 0, 0, 0.6);
  padding: 12px 20px;
  border-radius: 6px;
  color: #fff3cd;
  font-weight: bold;
  font-size: 14px;
  text-align: left;
  text-shadow: 0 0 4px black;
  z-index: 9998;
  display: none;
  opacity: 0;
  transition: opacity 0.4s ease;
  overflow-y: auto;
  white-space: normal;
  -webkit-overflow-scrolling: touch;
">
</div>
<script>
 function elegirSesion(tipo) {
  document.getElementById("modal-sesion").style.display = "none";
  document.getElementById("modal-modo").style.display = "flex";

  // üîá Detener audios previos (bienvenida y virtual)
  const audios = [
    document.getElementById("audio-intro"),
    document.getElementById("audio-virtual-en"),
    document.getElementById("audio-virtual-es")
  ];

  audios.forEach(audio => {
    if (audio && !audio.paused) {
      audio.pause();
      audio.currentTime = 0;
    }
  });

  // üîä Reproducir audio de modo virtual (si es el caso)
  if (tipo === "virtual") {
  const idioma = window.idiomaSeleccionado || "es";
  const archivo = idioma === "en"
    ? "modo_virtual_en.mp3"
    : "modo_virtual_esp.mp3";

  const audio = document.getElementById(
    idioma === "en" ? "audio-virtual-en" : "audio-virtual-es"
  );

  if (audio) {
    audio.play()
      .then(() => mostrarSubtituloDesdeAudio(archivo))
      .catch(e => console.warn("üîá No se pudo reproducir el audio virtual:", e));
  }
}

  // üîò Renderizar botones
  const botones = document.getElementById("botones-modos");
  botones.innerHTML = "";

  if (tipo === "virtual") {
    botones.innerHTML += `<button onclick="seleccionarModo('clasico')" style="margin: 10px; padding: 10px 20px; font-size: 16px; border-radius: 8px; background: #118ab2; color: white;">üÉè Clasico</button>`;
    botones.innerHTML += `<button onclick="seleccionarModo('cruz celta')" style="margin: 10px; padding: 10px 20px; font-size: 16px; border-radius: 8px; background: #06d6a0; color: white;">üîç Cruz Celta</button>`;
  } else {
    botones.innerHTML += `<button onclick="seleccionarModo('all')" style="margin: 10px; padding: 10px 20px; font-size: 16px; border-radius: 8px; background: #ffd166; color: black;">üìö Modo All</button>`;
  }
}
   
function seleccionarModo(modo) {
  document.getElementById("modal-modo").style.display = "none";
  window.modoSeleccionado = modo;

  console.log("‚úÖ Modo elegido:", modo);

  if (modo === 'clasico') {
  document.getElementById("boton-shuffle").style.display = "block";

  // Detener audios anteriores...
  const audios = [
    document.getElementById("audio-intro"),
    document.getElementById("audio-virtual-en"),
    document.getElementById("audio-virtual-es"),
    document.getElementById("audio-fan-en"),
    document.getElementById("audio-fan-es")
  ];
  audios.forEach(audio => {
    if (audio && !audio.paused) {
      audio.pause();
      audio.currentTime = 0;
    }
  });

  const idioma = window.idiomaSeleccionado || 'es';
  const archivo = idioma === 'en'
    ? "modo_clasico_en.mp3"
    : "modo_clasico_esp1.mp3";

  const audio = document.getElementById(
    idioma === 'en' ? "audio-fan-en" : "audio-fan-es"
  );

  if (audio) {
    window.audioFan = audio;
    audio.volume = 0.9;
    audio.play()
      .then(() => mostrarSubtituloDesdeAudio(archivo))
      .catch(err => console.warn("üéôÔ∏è Error al reproducir explicaci√≥n modo fan:", err));
  }
}


  // üÉè Ejecutar el modo real del mazo
  switch (modo) {
    case 'clasico':
      [...document.querySelectorAll('button')].find(btn => btn.textContent === 'Clasico')?.click();
      break;
    case 'cruz celta':
      [...document.querySelectorAll('button')].find(btn => btn.textContent === 'Cruz Celta')?.click();
      break;
    case 'all':
      [...document.querySelectorAll('button')].find(btn => btn.textContent === 'All')?.click();
      break;
  }}









  function saltarIntro() {
const audio = document.getElementById("audio-bienvenida");
audio.pause();
audio.currentTime = 0;

const canvas = document.getElementById("visualizador");
canvas.style.display = "none";
const ctx = canvas.getContext("2d");
ctx.clearRect(0, 0, canvas.width, canvas.height);
}

</script>
<script>
  window.addEventListener('DOMContentLoaded', () => {
    document.getElementById("boton-shuffle").style.display = "none";
  });
</script>

<script>
  function mezclarMazo() {
    if (window.deck && typeof window.deck.shuffle === 'function') {
      console.log("üîÄ Barajando el mazo...");
      window.deck.shuffle();
    } else {
      console.warn("‚ö†Ô∏è El mazo a√∫n no est√° disponible para mezclar.");
    }
  }
</script>

<script>
  window.idiomaSeleccionado = "es";

  const subtitulosAudios = {
    "intro1_esp.mp3": `‚ú® Bienvenido al Or√°culo del Tarot. Aqu√≠ comienzas un viaje hacia el conocimiento interior.

Puedes elegir entre dos modos de lectura: virtual y presencial.

En el modo virtual, tienes dos formas de exploraci√≥n:
üîÆ Una tirada cl√°sica de 3 cartas, que revela el pasado, el presente y el futuro,
üåü O una tirada m√°s profunda, el modo cruz celta, ideal para lecturas m√°s detalladas.

En el modo presencial, las cartas aparecer√°n boca arriba. Podr√°s observarlas con atenci√≥n y dejarlas hablarte.
Si lo deseas, puedes interpretar sus mensajes por tu cuenta, o dejar que el or√°culo te gu√≠e.

T√≥mate un momento. Respira hondo. Tu destino est√° por revelarse...`,
    "intro1_en.mp3": `‚ú® Welcome to the Tarot Oracle. Here begins your journey into inner wisdom.

You can choose between two reading modes: virtual and in-person.

In virtual mode, you have two paths to explore:
üîÆ A classic 3-card spread, revealing your past, present, and future,
üåü Or a deeper reading ‚Äî the Celtic Cross spread, ideal for more detailed insights.

In in-person mode, all the cards will appear face up. Take your time to observe them carefully and let them speak to you.
If you wish, you may interpret their messages on your own‚Ä¶ or let the oracle guide you.

Take a moment. Breathe deeply.
Your destiny is about to be revealed‚Ä¶`,
    "modo_virtual_esp.mp3": `Has elegido el modo virtual. En esta experiencia, puedes explorar el tarot a trav√©s de dos caminos:

üîÆ Una tirada cl√°sica de 3 cartas, donde deber√°s desplegar tres naipes frente a ti. Cada una representa tu pasado, tu presente y tu futuro.

üåÄ O una tirada m√°s profunda: la cruz celta. Ideal para una lectura m√°s completa sobre tu situaci√≥n actual y los caminos que se abren ante ti.

Elige con calma... y deja que las cartas hablen.`,
    "modo_virtual_en.mp3": `You have chosen the virtual mode. In this experience, you may explore the tarot through two paths:

üîÆ A classic 3-card spread, where you reveal three cards before you. They represent your past, your present, and your future.

üåÄ Or a deeper reading: the Celtic Cross. Ideal for gaining insight into your current situation and the paths that lie ahead.

Take a moment... and let the cards speak.`,
    "modo_clasico_esp1.mp3": `Has elegido el modo clasico.
En este modo, todas las cartas del tarot se desplegar√°n boca abajo frente a ti.
Puedes usar el bot√≥n  "Shuffle" para mezclar el mazo cuantas veces quieras, hasta sentir que est√°s listo.
Luego, pulsa el bot√≥n clasico para expandir el mazo.

Ahora comienza tu lectura:
Arrastra una por una las cartas que sientas conectadas contigo hacia el recuadro central.
La primera carta que selecciones representar√° tu pasado.
La segunda, tu presente.
Y la tercera, tu futuro.

Al colocar la tercera carta, el or√°culo realizar√° autom√°ticamente la lectura completa.
Respira‚Ä¶ y deja que el tarot hable por ti`,
    "modo_clasico_en.mp3": `You‚Äôve selected the Classic mode.
In this experience, all tarot cards will appear face down before you.
You can shuffle the deck as many times as you like using the ‚ÄúShuffle‚Äù button, until you feel ready.
Then, press the Classic button to spread the cards.

Begin your reading by dragging three cards, one by one, into the center frame.
The first card will reveal your past.
The second card, your present.
And the third and final card, your future.

Once you‚Äôve placed the third card, the oracle will automatically begin your full reading.
Take a deep breath‚Ä¶ and let the tarot speak to you.`
  };

  function mostrarSubtituloDesdeAudio(nombreArchivo) {
    const subtitulo = document.getElementById("subtitulo-audio");
    const texto = subtitulosAudios[nombreArchivo];

    if (texto) {
      subtitulo.textContent = texto;
      subtitulo.style.display = "block";
      subtitulo.style.opacity = "1";
      console.log("üìù Subt√≠tulo mostrado:", texto);

      setTimeout(() => {
        subtitulo.style.opacity = "0";
        setTimeout(() => {
          subtitulo.style.display = "none";
        }, 400);
      }, 60000);
    }
  }

  function toggleMute() {
    const isMuted = window.audioMuted || false;
    window.audioMuted = !isMuted;

    const audios = document.querySelectorAll("audio");
    audios.forEach(audio => {
      audio.muted = window.audioMuted;
    });

    const btn = document.getElementById("mute-button");
    const subtitulo = document.getElementById("subtitulo-audio");

    const idioma = window.idiomaSeleccionado || "es";
    const mensaje = idioma === "en" ? "üîá Audio muted" : "üîá Audio desactivado";

    if (window.audioMuted) {
      btn.textContent = "üîá";
      subtitulo.textContent = mensaje;
      subtitulo.style.display = "block";
      subtitulo.style.opacity = "1";
      console.log("üìù Subt√≠tulo mostrado:", mensaje);

      setTimeout(() => {
        subtitulo.style.opacity = "0";
        setTimeout(() => {
          subtitulo.style.display = "none";
        }, 400);
      }, 3000);

    } else {
      btn.textContent = "üîä";
      subtitulo.style.opacity = "0";
      setTimeout(() => {
        subtitulo.style.display = "none";
      }, 400);
    }
  }

  function reproducirAudioConSubtitulo(nombreArchivo) {
    const audio = new Audio(`static/${nombreArchivo}`);
    audio.play().catch(err => console.warn("üéôÔ∏è Error al reproducir:", err));
    mostrarSubtituloDesdeAudio(nombreArchivo);
  }
  
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<!-- ‚úÖ Tu funci√≥n personalizada -->
<script>
  async function generarLecturaPDF({ nombre, cartasSeleccionadas, interpretacion }) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(18);
    doc.text("Lectura del Tarot", 105, 20, { align: 'center' });

    const fecha = new Date().toLocaleString();
    doc.setFontSize(12);
    doc.text(`Nombre: ${nombre}`, 20, 30);
    doc.text(`Fecha: ${fecha}`, 20, 37);

    doc.setFontSize(14);
    doc.text("Interpretaci√≥n:", 20, 50);
    doc.setFontSize(11);
    const texto = doc.splitTextToSize(interpretacion, 170);
    doc.text(texto, 20, 60);

    for (let i = 0; i < cartasSeleccionadas.length; i++) {
      const img = await cargarImagenBase64(cartasSeleccionadas[i].imgSrc);
      doc.addImage(img, 'PNG', 20 + i * 60, 100, 50, 80);
      doc.text(cartasSeleccionadas[i].nombre, 25 + i * 60, 190);
    }

    doc.save("lectura_tarot.pdf");
  }

  function cargarImagenBase64(url) {
    return new Promise((resolve) => {
      const img = new Image();
      img.crossOrigin = 'Anonymous';
      img.onload = () => {
        const canvas = document.createElement("canvas");
        canvas.width = img.width;
        canvas.height = img.height;
        canvas.getContext("2d").drawImage(img, 0, 0);
        resolve(canvas.toDataURL("image/png"));
      };
      img.src = url;
    });
  }
</script>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    ["audio-virtual-es", "audio-intro", "audio-fan-es"].forEach(id => {
      const audio = document.getElementById(id);
      if (audio) {
        audio.addEventListener("play", () => {
          iniciarVisualizadorAudio(id);
        });
      }
    });
  });
</script>
  </body>
</html>